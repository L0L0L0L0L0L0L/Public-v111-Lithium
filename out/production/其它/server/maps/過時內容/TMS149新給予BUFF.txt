        public static byte[] giveBuff(int buffid, int bufflength, Map<MapleBuffStat, Integer> statups, MapleStatEffect effect) {
            MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();

            mplew.writeShort(SendPacketOpcode.GIVE_BUFF.getValue());
            PacketHelper.writeBuffMask(mplew, statups);
            int extra = 0;
            for (Entry<MapleBuffStat, Integer> stat : statups.entrySet()) {
                if (stat.getKey().canStack()) {
                    continue;
                }
                if (statups.containsKey(MapleBuffStat.MONSTER_RIDING) || statups.containsKey(MapleBuffStat.SPIRIT_SURGE) || statups.containsKey(MapleBuffStat.SPIRIT_LINK)) {
                    mplew.writeInt(stat.getValue());
                } else {
                    mplew.writeShort(stat.getValue());
                }
                mplew.writeInt(buffid);
                mplew.writeInt(bufflength);

            }
            mplew.write(0);
            mplew.write(0);
            mplew.write(0);
            if (statups.containsKey(MapleBuffStat.MONSTER_RIDING)) {
                mplew.writeInt(1932016);
                mplew.writeInt(buffid);
                mplew.writeInt(0);
            }
            for (Entry<MapleBuffStat, Integer> stat : statups.entrySet()) {
                if (!stat.getKey().canStack()) {
                    continue;
                }
                mplew.writeInt(1);
                mplew.writeInt(buffid);
                mplew.writeInt(stat.getValue());
                mplew.writeInt(0);
                mplew.writeInt(bufflength);
            }
            if (effect != null && effect.isDivineShield()) {
                mplew.writeInt(effect.getEnhancedWatk());
            } else if (statups.containsKey(MapleBuffStat.DARK_AURA)) {
                mplew.write(0);
            } else if (statups.containsKey(MapleBuffStat.BLUE_AURA)) {
                mplew.write(0);
            } else if (statups.containsKey(MapleBuffStat.YELLOW_AURA)) {
                mplew.write(0);
            } else if (statups.containsKey(MapleBuffStat.BODY_BOOST)) {
                mplew.writeInt(0);
            } else if (statups.containsKey(MapleBuffStat.COMBO) || statups.containsKey(MapleBuffStat.SUMMON)) {
                mplew.write(1); // who cares
            }
            mplew.write(0);
            mplew.writeZeroBytes(10);
            return mplew.getPacket();
        }
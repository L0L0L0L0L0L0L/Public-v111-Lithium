MapleMap.java

添加：

    private long lastPlayerLeft = System.currentTimeMillis();

    public boolean canDelete() {
        return (System.currentTimeMillis() - lastPlayerLeft > (30 * 60 * 1000L)) && (getCharactersSize() == 0);
    }




查找：

public final void removePlayer(final MapleCharacter chr) {




替换
public final void removePlayer(final MapleCharacter chr) {
lastPlayerLeft = System.currentTimeMillis();







World.java


查找
public static void handleMap(final MapleMap map, final int numTimes, final int size, final long now) {




替换
    public static void handleMap(final MapleMap map, final int numTimes, final int size, final long now) {
        if (map.canDelete()) {
            map.resetFully(false);
            MapleMapFactory mmf = ChannelServer.getInstance(map.getChannel()).getMapFactory();
            if (mmf.isMapLoaded(map.getId())) {
                if (mmf.getMap(map.getId()) == map) {
                    // Ensure we are deleting the right map
                    mmf.removeMap(map.getId());
                }
            }
            return;
        }







删除    

MAPLEMAP.JAVA

public boolean canDelete() {
        return this.characters.isEmpty() && !Mapinstance() && ChannelServer.getInstance(getChannel()).getMapFactory().isMapLoaded(mapid);
    }







WORLD.JAVA


        if (map.canDelete()) {
            map.resetFully(false);
            ChannelServer.getInstance(map.getChannel()).getMapFactory().removeMap(map.getId());
            System.out.println("Maple Map: " + map.getMapName() + " - ID: " + map.getId() + " has been unloaded from system.");
        }